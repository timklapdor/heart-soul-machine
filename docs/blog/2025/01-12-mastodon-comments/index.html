<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mastodon Comments</title>
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="icon" type="image/svg+xml" href="/assets/favicon.svg">
    <link rel="icon" type="image/png" href="/assets/favicon.png">

    <meta property="og:title" content="Mastodon Comments" />
    <meta property="og:url" content="/blog/2025/01-12-mastodon-comments/" />

  
	  <meta name="description" content="Looking to add comments to a static site? Maybe try Mastodon.">
	  <meta property="og:description" content="Looking to add comments to a static site? Maybe try Mastodon.">	
  
	  
    <meta name="fediverse:creator" content="@timklapdor@mastodon.social">

    
    <meta property="og:image" content="/assets/social-previews/mastodon-comments-preview.jpeg" />
    <meta property="og:image:secure_url" content="/assets/social-previews/mastodon-comments-preview.jpeg" /> 
    

    <link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/feed.xml">

    <!-- Matomo -->
      <script>
        var _paq = window._paq = window._paq || [];
        /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
        _paq.push(["setDoNotTrack", true]);
        _paq.push(["disableCookies"]);
        _paq.push(['trackPageView']);
        _paq.push(['enableLinkTracking']);
        (function() {
          var u="//timklapdor.me/analytics/";
          _paq.push(['setTrackerUrl', u+'matomo.php']);
          _paq.push(['setSiteId', '3']);
          var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
          g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
        })();
      </script>
      <noscript><p><img referrerpolicy="no-referrer-when-downgrade" src="//timklapdor.me/analytics/matomo.php?idsite=3&amp;rec=1" style="border:0;" alt="" /></p></noscript>
    <!-- End Matomo Code -->


  </head>

  <body>

    <aside>

    <header>
        <h1>Mastodon Comments</h1>
        <a href="/">
            <h1 class="logo-present">Mastodon Comments</h1>
            <img src="/assets/heart-soul-machine-logo.svg" alt="Mastodon Comments Logo">
          </a>
    </header>



    <nav role="navigation">
        <button class="menu-toggle" id="toggle" aria-expanded="false" aria-label="Menu Toggle">

          <svg class="ham hamRotate ham7" viewBox="0 0 100 100" width="80" onclick="this.classList.toggle('active')">
            <path
                  class="line top"
                  d="m 70,33 h -40 c 0,0 -6,1.368796 -6,8.5 0,7.131204 6,8.5013 6,8.5013 l 20,-0.0013" />
            <path
                  class="line middle"
                  d="m 70,50 h -40" />
            <path
                  class="line bottom"
                  d="m 69.575405,67.073826 h -40 c -5.592752,0 -6.873604,-9.348582 1.371031,-9.348582 8.244634,0 19.053564,21.797129 19.053564,12.274756 l 0,-40" />
          </svg>
        </button>
        <ul id="menu">
            
                 <li><a href="/">Home</a></li>
            
                 <li><a href="/blog/">Posts</a></li>
            
                 <li><a href="/notes/">Notes</a></li>
            
                 <li><a href="/about/">About</a></li>
            
                 <li><a href="/timeline/">Timeline</a></li>
            
                 <li><a href="/now/">Now</a></li>
            
                 <li><a href="/uses/">Uses</a></li>
            
                 <li><a href="/search/">Search</a></li>
            
        </ul>
    </nav>    
    <script>
        var toggle = document.querySelector('#toggle');
        var menu = document.querySelector('#menu');
        var menuItems = document.querySelectorAll('#menu li a');

        toggle.addEventListener('click', function(){
          if (menu.classList.contains('is-active')) {
            this.setAttribute('aria-expanded', 'false');
            menu.classList.remove('is-active');
          } else {
            menu.classList.add('is-active'); 
            this.setAttribute('aria-expanded', 'true');
            //menuItems[0].focus();
          }
        });
    </script>
    <a rel="me" href="https://mastodon.social/@timklapdor" style="display: none;">Mastodon</a>
    <div class="rss">
      <a href="/feed.xml">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar" width="24" height="24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 19m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" /><path d="M4 4a16 16 0 0 1 16 16" /><path d="M4 11a9 9 0 0 1 9 9" /></svg>
        </a>
     </div>

    </aside>

    <main>
      <article class="h-entry blogpost">

		
	<h1 class="p-name title ">Mastodon Comments</h1>
	
	<ul class="metadata">
		<li class="dt-published date">Jan 12, 2025</li>
		<li class="categories"> Technology, &amp; Social Media </li>
		<li class="time">4 minutes reading time</li>
	</ul>
	
	
	<div class="p-summary introduction">
		Looking to add comments to a static site? Maybe try Mastodon.
	</div>
	

	<p>Around this time last year, I started working on this blog. It was a project I really got my teeth into, and I had a few must-haves. The biggest was that I wanted it to be a static site - just files on a server - with no backend, database, admin, or maintenance required. I also wanted to have the whole thing run on files - markdown in particular - so whatever I wrote was easy to reuse and repurpose but stored and accessed without needing a website or technology to run.</p>
<p>I set up the site using  Eleventy (11ty) to do all this. I’d been a Jekyll user before and had encountered a few limitations that 11ty didn’t have. Being built in JavaScript rather than Ruby meant there was a larger community of developers engaged and a lot more portability of code.</p>
<p>One of the missing features of a static site is the lack of Web 2.0 features that enable user-generated content, such as comments. So essentially, the site has been operating as an OG weblog - and I liked that. Just me and some words</p>
<p>Then along comes agent provocateur Jim Groom:</p>
<iframe src="https://social.ds106.us/@jimgroom/113746590194162654/embed" width="400" allowfullscreen="allowfullscreen" sandbox="allow-scripts allow-same-origin allow-popups allow-popups-to-escape-sandbox allow-forms"></iframe>
<p>To be honest over the last year I have looked at a few options to add comments but I didn’t find many that didn’t leverage specific publishing systems (Netlify, GitHub) or weren’t a paid for service. Given this site currently costs me the fee for the domain and that’s it - paying for a service is not a cost I will bear. Also, IM not doing this site for clicks or user engagement, the only metric I’m worried about is my output and post count.  and while the site currently sits on GitHub Pages given the current rate of enshitification I didn’t want to move away from having the freedom to FTP the site anywhere and point the domain at somewhere new.</p>
<p>So at Jim’s behest, and using it as motivation I resumed my search, but this time I went to the search bar with a specific question – can you use Mastodon for comments?</p>
<p>I started here because I could see that Mastodon and ActivityPub could be an awesome way of combining blogs and interactions into the future. And while my simple 11ty blog wasn’t going to be able to run as an ActivityPub server - it had a lot of what’s needed to connect into that eco system.</p>
<p>And what I found was, <a href="https://fietkau.blog/2023/another_blog_resurrection_fediverse_new_comment_system" target="_blank" rel="noopener noreferrer">Yes! Yes you can use Mastodon for comments</a>. A number of posts discussed how they’d gone about it, <a href="https://cassidyjames.com/blog/fediverse-blog-comments-mastodon/" target="_blank" rel="noopener noreferrer">were sharing their code</a> - so I thought how hard could it be?</p>
<p>Well surprisingly simple! In about an hour I’d managed to copy the code, integrate, test and style it - and as a version 1.0 I’m very happy.</p>
<h3>How does it work?</h3>
<p>On my end I copied the code that Casey wrote - his c<a href="https://github.com/cassidyjames/cassidyjames.github.io/blob/main/_includes/comments.html" target="_blank" rel="noopener noreferrer">omments template</a> (which includes the js file) and the associated css files for the <a href="https://github.com/cassidyjames/cassidyjames.github.io/blob/main/_sass/_comments.scss" target="_blank" rel="noopener noreferrer">comments</a> and <a href="https://github.com/cassidyjames/cassidyjames.github.io/blob/main/_sass/_avatars.scss" target="_blank" rel="noopener noreferrer">avatars</a>.</p>
<p>From there I made a couple of tweaks to the variables used - and added those to my template metadata.</p>
<p><code>commentUsername</code> = your Mastodon name (the first @)<br>
<code>commentHost</code> = your Mastodon host (the second @)<br>
<code>commentId</code> = the Mastodon post ID that refers to the blog post</p>
<p>I tweaked the setup for 11ty - so I've put the <a href="https://github.com/timklapdor/heart-soul-machine/blob/main/src/_includes/partials/comments.njk" target="_blank" rel="noopener noreferrer">comments template</a> as a Partial that I can include in my template and I have the template pull in the comments section only if there is an Mastodon post ID is linked. This was to give me an opt in to comments - some posts I might not want them at all.</p>
<p>I’ve already set up <a href="https://echofeed.app/" target="_blank" rel="noopener noreferrer">EchoFeed</a> which automatically posts to Mastodon via the sites RSS. So once I've got that post - I can add the idea back into the post and republish. So rather than automatic there is a manual step - but it also gives me the power to opt in and out. Choices are a good thing.</p>
<p>If there is a comment ID attached to the post then the template will pick that  up and add the comment template - which all works client side via the Mastodon API:</p>
<pre><code>{%- if commentId | length -%}
  {% include &quot;partials/comments.njk&quot; %} 
{% endif %}
</code></pre>
<p>And from my end that's it. I found <a href="https://www.fabriziomusacchio.com/blog/2023-07-31-mastodon_blog_comment_system/" target="_blank" rel="noopener noreferrer">Fabrizio Musacchio's post</a> which added some other features - an API token so you can get more than 60 replies etc. But I also noted that he's not using his own Mastodon comments on the site... not sure why. I'll keep looking at this and see if any other features might be useful to add and poke around old posts and see which ones to add comments to.</p>

	<ul class="metadata">
		<li class="p-author author">Tim Klapdor</li>
		<li class="p-locality location">Adelaide, Australia</li>
		<li class="p-category tags">&amp; posts </li>
		
		
	</ul><section id="comments" class="comments">
  <hr>
  <h4>Comments</h4>
  <p>Comment on this blog post by publicly replying to <a href="https://mastodon.social/@timklapdor/113814512231769931">this Mastodon post</a> using a Mastodon or other ActivityPub/&ZeroWidthSpace;Fediverse account.</p>

  <div id="comments-wrapper">
    <p><small>No known comments, yet. Reply to <a href="https://mastodon.social/@timklapdor/113814512231769931">this Mastodon post</a> to add your own!</small></p>
    <noscript><p>Loading comments relies on JavaScript. Try enabling JavaScript and reloading, or visit <a href="https:///@/">the original post</a> on Mastodon.</p></noscript>
  </div>

  <script src="/assets/purify.min.js"></script>
  <script>
    loadComments ();

    function loadComments() {
      let commentsWrapper = document.getElementById("comments-wrapper");
      let postUrl = "https://mastodon.social/api/v1/statuses/113814512231769931";

      fetch(postUrl)
      .then(function(response) {
        return response.json();
      })
      .then(function(op) {
        fetch(postUrl + "/context")
        .then(function(response) {
          return response.json();
        })
        .then(function(data) {
          let descendants = data['descendants'];
          if(
            descendants &&
            Array.isArray(descendants) &&
            descendants.length > 0
          ) {
            commentsWrapper.innerHTML = "";
            descendants.unshift(op);

            data['descendants'].forEach(function(status) {
              if( status.account.display_name.length > 0 ) {
                status.account.display_name = escapeHtml(status.account.display_name);
                status.account.display_name = emojify(status.account.display_name, status.account.emojis);
              } else {
                status.account.display_name = status.account.username;
              };

              let instance = "";
              let verified = false;


              status.content = emojify(status.content, status.emojis);

              let avatarSource = document.createElement("source");
              avatarSource.setAttribute("srcset", escapeHtml(status.account.avatar));
              avatarSource.setAttribute("media", "(prefers-reduced-motion: no-preference)");

              let avatarImg = document.createElement("img");
              avatarImg.className = "avatar";
              avatarImg.setAttribute("src", escapeHtml(status.account.avatar_static));
              avatarImg.setAttribute("alt", `Avatar for @${ status.account.acct }`);

              let avatarPicture = document.createElement("picture");
              avatarPicture.appendChild(avatarSource);
              avatarPicture.appendChild(avatarImg);

              let avatarLink = document.createElement("a");
              avatarLink.className = "avatar-link";
              avatarLink.setAttribute("href", status.account.url);
              avatarLink.setAttribute("rel", "external nofollow");
              avatarLink.appendChild(avatarPicture);

              let instanceBadge = document.createElement("a");
              instanceBadge.className = "instance";
              instanceBadge.setAttribute("href", status.account.url);
              instanceBadge.setAttribute("title", `@${ status.account.username }@${ instance }`);
              instanceBadge.setAttribute("rel", "external nofollow");
              instanceBadge.textContent = instance;

              let account = document.createElement("a");
              account.className = "account";
              account.setAttribute("href", status.account.url);
              account.setAttribute("itemprop", "author");
              account.setAttribute("itemtype", "http://schema.org/Person");
              account.setAttribute("rel", "external nofollow");
              account.textContent = `@${ status.account.display_name }`;

              let header = document.createElement("h5");
              header.className = "author";
              header.innerHTML = status.account.display_name;
              header.appendChild(account);
              header.appendChild(instanceBadge);

              let permalink = document.createElement("a");
              permalink.setAttribute("href", status.url);
              permalink.setAttribute("itemprop", "url");
              permalink.setAttribute("title", `View comment at ${ instance }`);
              permalink.setAttribute("rel", "external nofollow");
              permalink.textContent = new Date( status.created_at ).toLocaleString('en-US', {
                dateStyle: "long",
                timeStyle: "short",
              });

              let timestamp = document.createElement("time");
              timestamp.setAttribute("datetime", status.created_at);
              timestamp.appendChild(permalink);

              let main = document.createElement("main");
              main.setAttribute("itemprop", "text");
              main.innerHTML = status.content;

              let comment = document.createElement("article");
              comment.id = `comment-${ status.id }`;
              comment.className = "comment";
              comment.setAttribute("itemprop", "comment");
              comment.setAttribute("itemtype", "http://schema.org/Comment");
              comment.appendChild(avatarLink);
              comment.appendChild(header);
              comment.appendChild(timestamp);
              comment.appendChild(main);

              if (verified === true) {
                comment.classList.add("verified");
              }

              commentsWrapper.innerHTML += DOMPurify.sanitize(comment.outerHTML);
            });
          }
        });
      });
    }

    function emojify(input, emojis) {
      let output = input;

      emojis.forEach(emoji => {
        let picture = document.createElement("picture");

        let source = document.createElement("source");
        source.setAttribute("srcset", escapeHtml(emoji.url));
        source.setAttribute("media", "(prefers-reduced-motion: no-preference)");

        let img = document.createElement("img");
        img.className = "emoji";
        img.setAttribute("src", escapeHtml(emoji.static_url));
        img.setAttribute("alt", `:${ emoji.shortcode }:`);
        img.setAttribute("title", `:${ emoji.shortcode }:`);
        img.setAttribute("width", "20");
        img.setAttribute("height", "20");

        picture.appendChild(source);
        picture.appendChild(img);

        output = output.replace(`:${ emoji.shortcode }:`, picture.outerHTML);
      });

      return output;
    }

    function escapeHtml(unsafe) {
      return unsafe
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/'/g, "&apos;")
        .replace(/"/g, "&quot;")
      ;
    }
  </script>
</section>
	

	<footer data-pagefind-ignore>
    <p>© Tim Klapdor 2025</p>
    <p class="name">Heart  |  Soul  |  Machine</p>
</footer>
</article>
    </main>

  </body>
</html>